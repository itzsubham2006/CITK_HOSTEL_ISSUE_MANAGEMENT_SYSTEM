{% extends "base.html" %}

{% block content %}

<!---------------- PAGE STYLE ---------------->

<div class="diary-page">

  <!-- PAGE TITLE -->
  <h2 class="page-title">üè† Hostel Diaries</h2>

  <!--  UPLOAD FORM  -->
  <div class="upload-box">
    <form method="POST" enctype="multipart/form-data">
      <input type="file" name="image" required>
      <input type="text" name="caption" placeholder="Share your hostel memory..." required>
      <button type="submit">Upload</button>
    </form>
  </div>

  <!--  DIARIES GRID  -->
  <div class="diary-grid">

    {% for diary in diaries %}
    <div class="diary-card">

      <!-- IMAGE -->
      <img src="{{ url_for('static', filename='uploads/' + diary.image) }}" alt="Hostel Memory" class="diary-image"
  onclick="openImage(this.src)">

      <!-- CAPTION -->
      <p class="caption">{{ diary.caption }}</p>

      <!-- USER -->
      <small class="user">‚Äî {{ diary.user.username }}</small>

      <!--  LIKE BUTTON  -->
      <button class="like-btn" data-id="{{ diary.id }}">
    ‚ù§Ô∏è <span id="like-count-{{ diary.id }}">{{ diary.likes | length }}</span>

    </button>

      <!--  COMMENTS  -->
      <div class="comments">
        {% for comment in diary.comments %}
          <p>
            <b>{{ comment.user.username }}</b> :
            {{ comment.comment }}
          </p>
        {% else %}
          <p class="no-comment">No comments yet</p>
        {% endfor %}
      </div>

      <!-- ADD COMMENT -->
      <form method="POST" action="{{ url_for('diary.comment_diary', id=diary.id) }}" class="comment-form">
        <input type="text" name="comment" placeholder="Write a comment..." required>
        <button type="submit">Post</button>
      </form>

    </div>
    {% endfor %}

  </div>
</div>

<!---------------- LIKE SCRIPT ---------------->
<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".like-btn").forEach(btn => {
    btn.addEventListener("click", function () {
      const diaryId = this.getAttribute("data-id");

      fetch(`/like-diary/${diaryId}`, { method: "POST" })
        .then(res => res.json())
        .then(data => {
          document.getElementById(`like-count-${diaryId}`).innerText = data.count;
        });
    });
  });
});
</script>


<!-- IMAGE VIEW MODAL -->
<div id="imageModal" class="image-modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="modalImg">
</div>

<script>
function openImage(src) {
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImg");

  modal.style.display = "block";
  modalImg.src = src;
}

document.querySelector(".close").onclick = function () {
  document.getElementById("imageModal").style.display = "none";
};

document.getElementById("imageModal").onclick = function (e) {
  if (e.target.id === "imageModal") {
    this.style.display = "none";
  }
};
</script>


{% endblock %}
