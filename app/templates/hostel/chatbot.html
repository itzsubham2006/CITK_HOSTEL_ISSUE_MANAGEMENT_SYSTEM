{% extends "base.html" %}
{%block title%}CITK HOSTEL MANAGEMENT SYSTEM | Hostel BOt{%endblock%}
 
{% block content %}
<div class="container d-flex justify-content-center mt-4" style="display: flex; justify-content:center; align-items:center">
  <div class="card shadow" style="width: 100%; max-width: 500px; display:flex; flex-direction:column; height:600px; border-radius:15px;">
    
  
    <div class="card-header text-white d-flex align-items-center" style="background:#68a86b; font-size:1.2rem; color:white">
    Hostel Assistant
    </div>

    
    <div class="card-body d-flex flex-column-reverse" id="chat-box"
         style="flex:1; overflow-y:auto; background:#f5fdf6; padding:15px;">
      <div style="color: #888; text-align:center;">Start chatting with your hostel assistant...</div>
    </div>

    <div class="card-footer d-flex gap-2" style="background:#e8f5e9; border-radius:0 0 15px 15px;">
      <input type="text" id="msg" class="form-control" placeholder="Ask about hostel..."
             onkeydown="if(event.key==='Enter') sendMsg()">
      <button class="btn btn-success" onclick="sendMsg()">Send</button>
    </div>
    
  </div>
</div>
<div class="notice">
  <h2 style="font-size: 20px; text-align:center; color:#2e7d32; margin-bottom:50px; ">This bot is in progress, coming soon...</h2>
</div>

<style>

.user-msg {
    background:#2e7d32;
    color:white;
    padding:8px 12px;
    border-radius:15px 15px 0 15px;
    margin:5px 0;
    max-width:80%;
    align-self:flex-end;
    word-wrap: break-word;
}

.bot-msg {
    background:#d9f0e1;
    color:#2e7d32;
    padding:8px 12px;
    border-radius:15px 15px 15px 0;
    margin:5px 0;
    max-width:80%;
    align-self:flex-start;
    word-wrap: break-word;
}


#chat-box::-webkit-scrollbar {
    width: 6px;
}
#chat-box::-webkit-scrollbar-thumb {
    background: #2e7d32;
    border-radius: 3px;
}
</style>

<script>
function sendMsg() {
  let msgInput = document.getElementById("msg");
  let msg = msgInput.value.trim();
  if (!msg) return;

  let chatBox = document.getElementById("chat-box");

  
  let userDiv = document.createElement("div");
  userDiv.className = "user-msg";
  userDiv.textContent = msg;
  chatBox.prepend(userDiv);

  msgInput.value = "";


  chatBox.scrollTop = chatBox.scrollHeight;

 
  fetch("/chatbot/message", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({message: msg})
  })
  .then(res => res.json())
  .then(data => {
    let botDiv = document.createElement("div");
    botDiv.className = "bot-msg";
    botDiv.textContent = data.reply;
    chatBox.prepend(botDiv);
  })
  .catch(() => {
    let botDiv = document.createElement("div");
    botDiv.className = "bot-msg";
    botDiv.textContent = "⚠️ AI service is temporarily unavailable.";
    chatBox.prepend(botDiv);
  });
}
</script>
{% endblock %}
